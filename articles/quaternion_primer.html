<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A primer on quaternions and rotations • imuf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A primer on quaternions and rotations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">imuf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/imuf.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/animate_imu.html">animate_imu</a></li>
    <li><a class="dropdown-item" href="../articles/imu_object.html">imu_object</a></li>
    <li><a class="dropdown-item" href="../articles/quaternion_primer.html">A primer on quaternions and rotations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gitboosting/imuf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A primer on quaternions and rotations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gitboosting/imuf/blob/main/vignettes/quaternion_primer.Rmd" class="external-link"><code>vignettes/quaternion_primer.Rmd</code></a></small>
      <div class="d-none name"><code>quaternion_primer.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gitboosting/imuf" class="external-link">imuf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RSpincalc</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pracma</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The imuf package uses the mathematics of quaternions to analyze the
data from an inertial measurement unit (IMU) and to track its
orientation in 3D. To use the package, it is helpful to understand what
quaternions are and how they operate as vectors and rotations.</p>
</div>
<div class="section level2">
<h2 id="what-is-a-quaternion">What is a quaternion?<a class="anchor" aria-label="anchor" href="#what-is-a-quaternion"></a>
</h2>
<p>A quaternion is a 4-componment mathematical object
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>=</mo><msub><mi>q</mi><mi>w</mi></msub><mo>+</mo><mi>i</mi><msub><mi>q</mi><mi>x</mi></msub><mo>+</mo><mi>j</mi><msub><mi>q</mi><mi>y</mi></msub><mo>+</mo><mi>k</mi><msub><mi>q</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">q = q_{w} + i q_{x} + j q_{y} + k q_{z}</annotation></semantics></math>
with a scalar component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>w</mi></msub><annotation encoding="application/x-tex">q_{w}</annotation></semantics></math>
and a vector component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>q</mi><mi>x</mi></msub><mo>,</mo><msub><mi>q</mi><mi>y</mi></msub><mo>,</mo><msub><mi>q</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(q_{x}, q_{y}, q_{z})</annotation></semantics></math>.
The quaternion units
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">i, j, k</annotation></semantics></math>
are analogous to the imaginary unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><msqrt><mrow><mo>−</mo><mn>1</mn></mrow></msqrt></mrow><annotation encoding="application/x-tex">i = \sqrt{-1}</annotation></semantics></math>
in complex numbers, except that in quaternions there are three units and
they obey the following relationships:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>i</mi><mn>2</mn></msup><mo>=</mo><msup><mi>j</mi><mn>2</mn></msup><mo>=</mo><msup><mi>k</mi><mn>2</mn></msup><mo>=</mo><mi>i</mi><mi>j</mi><mi>k</mi><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i^2 = j^2 = k^2 = i j k = -1</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>j</mi><mo>=</mo><mo>−</mo><mi>j</mi><mi>i</mi><mo>=</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">i j = - j i = k</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>i</mi><mo>=</mo><mo>−</mo><mi>i</mi><mi>k</mi><mo>=</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">k i = - i k = j</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mi>k</mi><mo>=</mo><mo>−</mo><mi>k</mi><mi>j</mi><mo>=</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">j k = - k j = i</annotation></semantics></math></p>
<p>Quaternion algebra is similar to complex number algebra, but with the
added complications of having four components and the quaternion units
needing to obey a more extensive set of rules as stated above.</p>
<p>It’s important to note that in a multiplication, order matters.
Quaternions generally do not commute:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub><msub><mi>q</mi><mn>2</mn></msub><mo>≠</mo><msub><mi>q</mi><mn>2</mn></msub><msub><mi>q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">q_{1} q_{2} \neq q_{2} q_{1}</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="quaternions-as-rotations-and-vectors">Quaternions as rotations and vectors<a class="anchor" aria-label="anchor" href="#quaternions-as-rotations-and-vectors"></a>
</h2>
<p>A quaternion can represent a rotation or a vector.</p>
<div class="section level3">
<h3 id="rotation-quaternions">Rotation quaternions<a class="anchor" aria-label="anchor" href="#rotation-quaternions"></a>
</h3>
<p>A rotation of angle
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
around an axis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐯</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mi>x</mi></msub><mo>,</mo><msub><mi>v</mi><mi>y</mi></msub><mo>,</mo><msub><mi>v</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{v} = (v_{x}, v_{y}, v_{z})</annotation></semantics></math>
with a unit length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><msubsup><mi>v</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>v</mi><mi>y</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>v</mi><mi>z</mi><mn>2</mn></msubsup></mrow></msqrt><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sqrt{v_{x}^2 + v_{y}^2 + v_{z}^2} = 1</annotation></semantics></math>
can be represented by a rotation quaternion:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo>,</mo><mi>𝐯</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>θ</mi><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>s</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>θ</mi><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><msub><mi>v</mi><mi>x</mi></msub><mo>+</mo><mi>j</mi><msub><mi>v</mi><mi>y</mi></msub><mo>+</mo><mi>k</mi><msub><mi>v</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">q(\theta, \mathbf{v}) = cos(\frac{\theta}{2}) + sin(\frac{\theta}{2}) (i v_{x} + j v_{y} + k v_{z})</annotation></semantics></math></p>
<p>The relation between the quaternion components and the axis-angle
representation is:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>q</mi><mi>w</mi></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>q</mi><mi>x</mi></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>q</mi><mi>y</mi></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>q</mi><mi>z</mi></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>c</mi><mi>o</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>v</mi><mi>x</mi></msub><mi>s</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>v</mi><mi>y</mi></msub><mi>s</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>v</mi><mi>z</mi></msub><mi>s</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>c</mi><mi>o</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>𝐯</mi><mi>s</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} q_{w} \\ q_{x} \\ q_{y} \\ q_{z}  \end{bmatrix} = \begin{bmatrix} cos(\theta/2) \\ v_{x} sin(\theta/2) \\ v_{y} sin(\theta/2) \\ v_{z} sin(\theta/2) \end{bmatrix} = \begin{bmatrix}cos(\theta/2) \\ \mathbf{v} sin(\theta/2)\end{bmatrix}</annotation></semantics></math></p>
<p>Rotation quaternions have unit length:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><msubsup><mi>q</mi><mi>w</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>q</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>q</mi><mi>y</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>q</mi><mi>z</mi><mn>2</mn></msubsup><mo stretchy="false" form="postfix">)</mo></mrow></msqrt><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sqrt{q_{w}^2 + q_{x}^2 + q_{y}^2 + q_{z}^2)} = 1</annotation></semantics></math>.
After an numerical operation it may be necessary to re-normalize a
rotation quaternion to unit length.</p>
</div>
<div class="section level3">
<h3 id="vector-quaternions">Vector quaternions<a class="anchor" aria-label="anchor" href="#vector-quaternions"></a>
</h3>
<p>A quaternion representing a vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐮</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>u</mi><mi>x</mi></msub><mo>,</mo><msub><mi>u</mi><mi>y</mi></msub><mo>,</mo><msub><mi>u</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{u} = (u_{x}, u_{y}, u_{z})</annotation></semantics></math>
has a zero scalar part:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>u</mi></msub><mo>=</mo><mn>0</mn><mo>+</mo><mi>i</mi><msub><mi>u</mi><mi>x</mi></msub><mo>+</mo><mi>j</mi><msub><mi>u</mi><mi>y</mi></msub><mo>+</mo><mi>k</mi><msub><mi>u</mi><mi>z</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>𝐮</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">q_{u} = 0 + i u_{x} + j u_{y} + k u_{z} = \begin{bmatrix} 0 \\ \mathbf{u} \end{bmatrix}</annotation></semantics></math></p>
<p>Unlike a rotation quaternion which has a unit length, a vector
quaternion can have an arbitrary length.</p>
</div>
<div class="section level3">
<h3 id="conjugate">Conjugate<a class="anchor" aria-label="anchor" href="#conjugate"></a>
</h3>
<p>The conjugate of a quaternion is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>q</mi><mo>*</mo></msup><mo>=</mo><msub><mi>q</mi><mi>w</mi></msub><mo>−</mo><mi>i</mi><msub><mi>q</mi><mi>x</mi></msub><mo>−</mo><mi>j</mi><msub><mi>q</mi><mi>y</mi></msub><mo>−</mo><mi>k</mi><msub><mi>q</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">q^* = q_{w} - i q_{x} - j q_{y} - k q_{z}</annotation></semantics></math>.
Conjugate of a rotation quaternion represents a rotation in the opposite
direction. Conjugate of a vector quaternion represents a vector pointing
in the opposite direction.</p>
</div>
<div class="section level3">
<h3 id="rotating-a-vector">Rotating a vector<a class="anchor" aria-label="anchor" href="#rotating-a-vector"></a>
</h3>
<p>One can rotate a vector, represented by a vector quaternion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>u</mi></msub><annotation encoding="application/x-tex">q_{u}</annotation></semantics></math>,
by a rotation, represented by a rotation quaternion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>,
using the following transformation:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><msub><mi>′</mi><mi>u</mi></msub><mo>=</mo><mi>q</mi><msub><mi>q</mi><mi>u</mi></msub><msup><mi>q</mi><mo>*</mo></msup></mrow><annotation encoding="application/x-tex">q'_{u} = q q_{u} q^*</annotation></semantics></math></p>
<p>The resulting vector quaternion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><msub><mi>′</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">q'_{u}</annotation></semantics></math>
represents the rotated vector.</p>
<p>For example, rotating a vector of length 2 along the y-axis about the
x-axis by 90 degrees or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>/2
results in a vector of length 2 along the z-axis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>   <span class="co"># quaternion of a vector of length 2 along the y-axis</span></span>
<span><span class="va">angle</span> <span class="op">&lt;-</span> <span class="va">pi</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">angle</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">angle</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>   <span class="co"># quaternion of a rotation about the x-axis by pi/2</span></span>
<span><span class="va">qconj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/Qconj.html" class="external-link">Qconj</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span>    <span class="co"># conjugate of the rotation quaternion</span></span>
<span><span class="co">#</span></span>
<span><span class="va">qu_rotated</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qu</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qconj</span></span>
<span><span class="va">qu_rotated</span></span>
<span><span class="co">#&gt;      [,1] [,2]         [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    0    0 4.440892e-16    2</span></span></code></pre></div>
<p>Another rotation about the z-axis leaves the vector unchanged:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qu</span> <span class="op">&lt;-</span> <span class="va">qu_rotated</span>   <span class="co"># start with the rotated vector from previous step</span></span>
<span><span class="va">angle</span> <span class="op">&lt;-</span> <span class="va">pi</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">angle</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">angle</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>   <span class="co"># quaternion of a rotation about the z-axis by pi/2</span></span>
<span><span class="va">qconj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/Qconj.html" class="external-link">Qconj</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span>    <span class="co"># conjugate of the rotation quaternion</span></span>
<span><span class="co">#</span></span>
<span><span class="va">qu_rotated</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qu</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qconj</span></span>
<span><span class="va">qu_rotated</span></span>
<span><span class="co">#&gt;      [,1]          [,2]         [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    0 -4.440892e-16 9.860761e-32    2</span></span></code></pre></div>
<p>Note that rotations do not commute. Reversing the order by rotating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>u</mi></msub><annotation encoding="application/x-tex">q_{u}</annotation></semantics></math>
about the z-axis by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>/2
first and then about the x-axis by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>/2
second yields a different result:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>   <span class="co"># start with a vector of length 2 along the y-axis</span></span>
<span><span class="va">angle</span> <span class="op">&lt;-</span> <span class="va">pi</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">angle</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">angle</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>   <span class="co"># rotation about the z-axis by pi/2</span></span>
<span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">angle</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">angle</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>   <span class="co"># rotation about the x-axis by pi/2</span></span>
<span><span class="va">q1conj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/Qconj.html" class="external-link">Qconj</a></span><span class="op">(</span><span class="va">q1</span><span class="op">)</span>    <span class="co"># conjugate of q1</span></span>
<span><span class="va">q2conj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/Qconj.html" class="external-link">Qconj</a></span><span class="op">(</span><span class="va">q2</span><span class="op">)</span>    <span class="co"># conjugate of q2</span></span>
<span><span class="co">#</span></span>
<span><span class="va">qu_rotated</span> <span class="op">&lt;-</span> <span class="va">q1</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qu</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">q1conj</span></span>
<span><span class="va">qu_rotated</span> <span class="op">&lt;-</span> <span class="va">q2</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qu_rotated</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">q2conj</span></span>
<span><span class="co">#</span></span>
<span><span class="va">qu_rotated</span>    <span class="co"># this vector quaternion is different from the one in the previous section</span></span>
<span><span class="co">#&gt;      [,1] [,2]         [,3]         [,4]</span></span>
<span><span class="co">#&gt; [1,]    0   -2 9.860761e-32 4.440892e-16</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cross-product-and-dot-product">Cross product and dot product<a class="anchor" aria-label="anchor" href="#cross-product-and-dot-product"></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/Cross_product" class="external-link">Cross
product</a> and <a href="https://en.wikipedia.org/wiki/Dot_product" class="external-link">dot
product</a> are useful vector operations that can be performed by
quaternions. When we multiply two vector quaternions, the scalar
component of the resulting quaternion is the negative dot product and
the vector component the cross product:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>a</mi></msub><mo>=</mo><mn>0</mn><mo>+</mo><mi>i</mi><msub><mi>a</mi><mi>x</mi></msub><mo>+</mo><mi>j</mi><msub><mi>a</mi><mi>y</mi></msub><mo>+</mo><mi>k</mi><msub><mi>a</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">q_{a} = 0 + i a_{x} + j a_{y} + k a_{z}</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>b</mi></msub><mo>=</mo><mn>0</mn><mo>+</mo><mi>i</mi><msub><mi>b</mi><mi>x</mi></msub><mo>+</mo><mi>j</mi><msub><mi>b</mi><mi>y</mi></msub><mo>+</mo><mi>k</mi><msub><mi>b</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">q_{b} = 0 + i b_{x} + j b_{y} + k b_{z}</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>a</mi></msub><msub><mi>q</mi><mi>b</mi></msub><mo>=</mo><msub><mi>q</mi><mi>c</mi></msub><mo>=</mo><msub><mi>c</mi><mi>w</mi></msub><mo>+</mo><mi>i</mi><msub><mi>c</mi><mi>x</mi></msub><mo>+</mo><mi>j</mi><msub><mi>c</mi><mi>y</mi></msub><mo>+</mo><mi>k</mi><msub><mi>c</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">q_{a} q_{b} = q_{c} = c_{w} + i c_{x} + j c_{y} + k c_{z}</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>w</mi></msub><mo>=</mo><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo>,</mo><msub><mi>a</mi><mi>y</mi></msub><mo>,</mo><msub><mi>a</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mi>x</mi></msub><mo>,</mo><msub><mi>b</mi><mi>y</mi></msub><mo>,</mo><msub><mi>b</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">c_{w} = - (a_{x}, a_{y}, a_{z}) \cdot (b_{x}, b_{y}, b_{z})</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>c</mi><mi>x</mi></msub><mo>,</mo><msub><mi>c</mi><mi>y</mi></msub><mo>,</mo><msub><mi>c</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo>,</mo><msub><mi>a</mi><mi>y</mi></msub><mo>,</mo><msub><mi>a</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mi>x</mi></msub><mo>,</mo><msub><mi>b</mi><mi>y</mi></msub><mo>,</mo><msub><mi>b</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">(c_{x}, c_{y}, c_{z}) = (a_{x}, a_{y}, a_{z}) \times (b_{x}, b_{y}, b_{z})</annotation></semantics></math></p>
<p>More succinctly,</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>a</mi></msub><msub><mi>q</mi><mi>b</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mo>−</mo><mi>𝐚</mi><mo>⋅</mo><mi>𝐛</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>𝐚</mi><mo>×</mo><mi>𝐛</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">q_{a} q_{b} = \begin{bmatrix} -\mathbf{a} \cdot \mathbf{b} \\ \mathbf{a} \times \mathbf{b} \end{bmatrix}</annotation></semantics></math></p>
<p>Let’s quickly verify these with a concrete example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>   <span class="co"># some arbitrary vector</span></span>
<span><span class="va">qb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>   <span class="co"># another arbitrary vector</span></span>
<span><span class="co">#</span></span>
<span><span class="op">(</span><span class="va">qc</span> <span class="op">&lt;-</span> <span class="va">qa</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qb</span><span class="op">)</span>      <span class="co"># quaternion product</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]  -32   -3    6   -3</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># dot and cross product the normal way</span></span>
<span><span class="op">(</span><span class="va">a_dot_b</span> <span class="op">&lt;-</span> <span class="va">qa</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">qb</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]   32</span></span>
<span><span class="co">#</span></span>
<span><span class="op">(</span><span class="va">a_cross_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pracma/man/cross.html" class="external-link">cross</a></span><span class="op">(</span><span class="va">qa</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">qb</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -3  6 -3</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># scalar of quaternion == negative dot product</span></span>
<span><span class="co"># vector of quaternion == cross product</span></span>
<span><span class="va">qc</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">*</span> <span class="va">a_dot_b</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,] TRUE</span></span>
<span><span class="va">qc</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="va">a_cross_b</span></span>
<span><span class="co">#&gt; [1] TRUE TRUE TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="more-quaternion-operations">More quaternion operations<a class="anchor" aria-label="anchor" href="#more-quaternion-operations"></a>
</h2>
<p>Now that we are familiar with the basic characteristics of
quaternions and their relations to 3-vectors and 3D rotations, let’s
delve into some quaternion operations that are relevant in sensor
fusion.</p>
<div class="section level3">
<h3 id="finding-a-rotation-that-rotates-a-unit-vector-into-another">Finding a rotation that rotates a unit vector into another<a class="anchor" aria-label="anchor" href="#finding-a-rotation-that-rotates-a-unit-vector-into-another"></a>
</h3>
<p>Say we want to rotate a unit vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐚</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo>,</mo><msub><mi>a</mi><mi>y</mi></msub><mo>,</mo><msub><mi>a</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{a} = (a_{x}, a_{y}, a_{z})</annotation></semantics></math>
into another unit vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐛</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mi>x</mi></msub><mo>,</mo><msub><mi>b</mi><mi>y</mi></msub><mo>,</mo><msub><mi>b</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{b} = (b_{x}, b_{y}, b_{z})</annotation></semantics></math>.
Represented in quaternions, vectors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐚</mi><annotation encoding="application/x-tex">\mathbf{a}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐛</mi><annotation encoding="application/x-tex">\mathbf{b}</annotation></semantics></math>
become
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>a</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>a</mi><mi>x</mi></msub><mo>,</mo><msub><mi>a</mi><mi>y</mi></msub><mo>,</mo><msub><mi>a</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">q_{a} = (0, a_{x}, a_{y}, a_{z})</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>b</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>b</mi><mi>x</mi></msub><mo>,</mo><msub><mi>b</mi><mi>y</mi></msub><mo>,</mo><msub><mi>b</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">q_{b} = (0, b_{x}, b_{y}, b_{z})</annotation></semantics></math>.
The objective is to find a rotation quaternion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>b</mi></msub><mo>=</mo><mi>q</mi><msub><mi>q</mi><mi>a</mi></msub><msup><mi>q</mi><mo>*</mo></msup></mrow><annotation encoding="application/x-tex">q_{b} = q q_{a} q^*</annotation></semantics></math>.</p>
<p>The rotation we seek has an axis of rotation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐧</mi><annotation encoding="application/x-tex">\mathbf{n}</annotation></semantics></math>
that is perpendicular to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐚</mi><annotation encoding="application/x-tex">\mathbf{a}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐛</mi><annotation encoding="application/x-tex">\mathbf{b}</annotation></semantics></math>,
and an angle of rotation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
that is the angle between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐚</mi><annotation encoding="application/x-tex">\mathbf{a}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐛</mi><annotation encoding="application/x-tex">\mathbf{b}</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐧</mi><annotation encoding="application/x-tex">\mathbf{n}</annotation></semantics></math>
is given by the cross product of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐚</mi><annotation encoding="application/x-tex">\mathbf{a}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐛</mi><annotation encoding="application/x-tex">\mathbf{b}</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
can be derived from the dot product of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐚</mi><annotation encoding="application/x-tex">\mathbf{a}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐛</mi><annotation encoding="application/x-tex">\mathbf{b}</annotation></semantics></math>.
Both of these can be read off from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>a</mi></msub><msub><mi>q</mi><mi>b</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mi>𝐚</mi><mo>⋅</mo><mi>𝐛</mi><mo>,</mo><mi>𝐚</mi><mo>×</mo><mi>𝐛</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">q_{a} q_{b} = (- \mathbf{a} \cdot \mathbf{b}, \mathbf{a} \times \mathbf{b})</annotation></semantics></math>.
The angle of rotation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><msup><mi>s</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐚</mi><mo>⋅</mo><mi>𝐛</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">cos^{-1}(\mathbf{a} \cdot \mathbf{b})</annotation></semantics></math>.</p>
<p>Let’s verify these with a concrete example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>; <span class="op">(</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/pracma/man/norm.html" class="external-link">Norm</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2672612 0.5345225 0.8017837</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>; <span class="op">(</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/pracma/man/norm.html" class="external-link">Norm</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4216370 0.5270463 0.7378648</span></span>
<span><span class="op">(</span><span class="va">qa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0000000 0.2672612 0.5345225 0.8017837</span></span>
<span><span class="op">(</span><span class="va">qb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0000000 0.4216370 0.5270463 0.7378648</span></span>
<span><span class="co">#</span></span>
<span><span class="op">(</span><span class="va">qaqb</span> <span class="op">&lt;-</span> <span class="va">qa</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qb</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]        [,2]     [,3]        [,4]</span></span>
<span><span class="co">#&gt; [1,] -0.9860133 -0.02817181 0.140859 -0.08451543</span></span>
<span><span class="op">(</span><span class="va">a_dot_b</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">qaqb</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9860133</span></span>
<span><span class="op">(</span><span class="va">a_cross_b</span> <span class="op">&lt;-</span> <span class="va">qaqb</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.02817181  0.14085904 -0.08451543</span></span>
<span><span class="co">#</span></span>
<span><span class="op">(</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">a_cross_b</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/pracma/man/norm.html" class="external-link">Norm</a></span><span class="op">(</span><span class="va">a_cross_b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.1690309  0.8451543 -0.5070926</span></span>
<span><span class="op">(</span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">acos</a></span><span class="op">(</span><span class="va">a_dot_b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1674481</span></span>
<span><span class="op">(</span><span class="va">half_theta</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.08372404</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># rotation quaternion</span></span>
<span><span class="op">(</span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">half_theta</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">half_theta</span><span class="op">)</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.99649719 -0.01413542  0.07067709 -0.04240625</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># verification</span></span>
<span><span class="op">(</span><span class="va">qb_expected</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="va">qa</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/Qconj.html" class="external-link">Qconj</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]     [,2]      [,3]      [,4]</span></span>
<span><span class="co">#&gt; [1,]    0 0.421637 0.5270463 0.7378648</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">qb</span>, <span class="fl">8</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">qb_expected</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,] TRUE TRUE TRUE TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="angular-distance-between-2-orientations">Angular distance between 2 orientations<a class="anchor" aria-label="anchor" href="#angular-distance-between-2-orientations"></a>
</h3>
<p>Given two orientations how do we quantify how close they are?</p>
<p>Suppose we have two orientations represented by rotation quaternions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>a</mi></msub><annotation encoding="application/x-tex">q_{a}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>b</mi></msub><annotation encoding="application/x-tex">q_{b}</annotation></semantics></math>.
We can apply a third quaternion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>c</mi></msub><annotation encoding="application/x-tex">q_{c}</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>a</mi></msub><annotation encoding="application/x-tex">q_{a}</annotation></semantics></math>
so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>c</mi></msub><msub><mi>q</mi><mi>a</mi></msub><mo>=</mo><msub><mi>q</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">q_{c} q_{a} = q_{b}</annotation></semantics></math>.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>c</mi></msub><annotation encoding="application/x-tex">q_{c}</annotation></semantics></math>
is the extra bit of rotation required to align
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>a</mi></msub><annotation encoding="application/x-tex">q_{a}</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>b</mi></msub><annotation encoding="application/x-tex">q_{b}</annotation></semantics></math>.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>c</mi></msub><mo>=</mo><msub><mi>q</mi><mi>b</mi></msub><msubsup><mi>q</mi><mi>a</mi><mo>*</mo></msubsup></mrow><annotation encoding="application/x-tex">q_{c} = q_{b} q_{a}^*</annotation></semantics></math></p>
<p>The rotation angle of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>c</mi></msub><annotation encoding="application/x-tex">q_{c}</annotation></semantics></math>
is the “angular distance” between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>a</mi></msub><annotation encoding="application/x-tex">q_{a}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>b</mi></msub><annotation encoding="application/x-tex">q_{b}</annotation></semantics></math>.
It quantifies the closeness between the two orientations. The angle is
twice the arccosine of the scalar componment of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>c</mi></msub><annotation encoding="application/x-tex">q_{c}</annotation></semantics></math>.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>c</mi></msub><mo>=</mo><mn>2</mn><mo>×</mo><mi>a</mi><mi>c</mi><mi>o</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>q</mi><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_{c} = 2 \times acos(q_{c}[1])</annotation></semantics></math></p>
<p>Let’s look at a concrete example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># some arbitrary orientations</span></span>
<span><span class="op">(</span><span class="va">qa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/pracma/man/sind.html" class="external-link">cosd</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/pracma/man/sind.html" class="external-link">sind</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/pracma/man/norm.html" class="external-link">Norm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9063078 0.2439988 0.2439988 0.2439988</span></span>
<span><span class="op">(</span><span class="va">qb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/pracma/man/sind.html" class="external-link">cosd</a></span><span class="op">(</span><span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/pracma/man/sind.html" class="external-link">sind</a></span><span class="op">(</span><span class="fl">35</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/pracma/man/norm.html" class="external-link">Norm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.8191520 -0.1532948 -0.3065895  0.4598843</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># quaternion needed to align qa and qb</span></span>
<span><span class="op">(</span><span class="va">qc</span> <span class="op">&lt;-</span> <span class="va">qb</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/Qconj.html" class="external-link">Qconj</a></span><span class="op">(</span><span class="va">qa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]       [,2]       [,3]      [,4]</span></span>
<span><span class="co">#&gt; [1,] 0.7424039 -0.1517857 -0.6273515 0.1795209</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># rotation angle of qc</span></span>
<span><span class="op">(</span><span class="va">qc_angle</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">acos</a></span><span class="op">(</span><span class="va">qc</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.46829</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># verify with the library function RSpincalc::QangularDifference</span></span>
<span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="va">qa</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/Qzero.html" class="external-link">Qone</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="va">qb</span> <span class="op"><a href="https://rdrr.io/pkg/RSpincalc/man/z1.html" class="external-link">%Q*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/Qzero.html" class="external-link">Qone</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">qc_expected</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/RSpincalc/man/QangularDifference.html" class="external-link">QangularDifference</a></span><span class="op">(</span><span class="va">q1</span>, <span class="va">q2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.46829</span></span>
<span><span class="co">#</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">qc_angle</span>, <span class="fl">8</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">qc_expected</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Felix Chan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
