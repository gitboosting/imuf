<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>imuf • imuf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="imuf">
<meta name="description" content="Learn how to use `compUpdate()` and `rotV()` functions to analyze a dataset of accelerometer and gyroscope measurements from real world activities.">
<meta property="og:description" content="Learn how to use `compUpdate()` and `rotV()` functions to analyze a dataset of accelerometer and gyroscope measurements from real world activities.">
<meta property="og:image" content="https://gitboosting.github.io/imuf/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">imuf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/imuf.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/animate_imu.html">animate_imu</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gitboosting/imuf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>imuf</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gitboosting/imuf/blob/main/vignettes/imuf.Rmd" class="external-link"><code>vignettes/imuf.Rmd</code></a></small>
      <div class="d-none name"><code>imuf.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The imuf package performs sensor fusion for an inertial measurement
unit (IMU) that has a 3-axis accelerometer and a 3-axis gyroscope.</p>
<p>Specifically, <code><a href="../reference/compUpdate.html">compUpdate()</a></code> uses <a href="https://stanford.edu/class/ee267/notes/ee267_notes_imu.pdf" class="external-link">complementary
filtering</a> to estimate the sensor’s final orientation, given its
initial orientation, sensor readings of accelerations and angular
velocities at a time point, time duration between data samples, and a
gain factor (between 0 and 1) specifying the weighting of the
accelerometer measurements.</p>
<p>This vignette describes how one may use the imuf package to analyze a
real world dataset of IMU measurements.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gitboosting/imuf" class="external-link">imuf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>The <code>walking_shin_1</code> dataset contains 31,946 rows of
sensor readings. Each reading consists of 3 accelerations (m/s^2) and 3
angular velocities (rad/sec) measurements for north (x), east (y), and
down (z) directions. The data sampling rate is 50 Hz, which translates
to a time duration of 0.02 second between readings.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">walking_shin_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   acc_x acc_y  acc_z   gyr_x     gyr_y   gyr_z</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> -<span style="color: #BB0000;">1.44</span> 0.803 -<span style="color: #BB0000;">10.0</span>  -<span style="color: #BB0000;">0.023</span><span style="color: #BB0000; text-decoration: underline;">8</span>  0.002<span style="text-decoration: underline;">44</span>  -<span style="color: #BB0000;">0.040</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> -<span style="color: #BB0000;">1.40</span> 0.785  -<span style="color: #BB0000;">9.94</span> -<span style="color: #BB0000;">0.017</span><span style="color: #BB0000; text-decoration: underline;">7</span>  0.003<span style="text-decoration: underline;">36</span>  -<span style="color: #BB0000;">0.021</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> -<span style="color: #BB0000;">1.36</span> 0.784  -<span style="color: #BB0000;">9.95</span> -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">5</span>  0.001<span style="text-decoration: underline;">83</span>  -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> -<span style="color: #BB0000;">1.33</span> 0.746  -<span style="color: #BB0000;">9.97</span> -<span style="color: #BB0000;">0.022</span><span style="color: #BB0000; text-decoration: underline;">3</span> -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">75</span>  -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> -<span style="color: #BB0000;">1.32</span> 0.724  -<span style="color: #BB0000;">9.96</span> -<span style="color: #BB0000;">0.024</span><span style="color: #BB0000; text-decoration: underline;">1</span> -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">916</span> -<span style="color: #BB0000;">0.023</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> -<span style="color: #BB0000;">1.39</span> 0.785  -<span style="color: #BB0000;">9.97</span> -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">6</span> -<span style="color: #BB0000;">0.003</span><span style="color: #BB0000; text-decoration: underline;">67</span>  -<span style="color: #BB0000;">0.031</span><span style="color: #BB0000; text-decoration: underline;">2</span></span></span></code></pre></div>
<p>To prepare for subsequent analyses, we first convert the dataframe to
a list:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lst_ned_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">walking_shin_1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">unname</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lst_ned_in</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] -1.440710900  0.803254660 -9.996989000 -0.023823744  0.002443461</span></span>
<span><span class="co">#&gt; [6] -0.040622540</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] -1.398812300  0.785298170 -9.943120000 -0.017715093  0.003359759</span></span>
<span><span class="co">#&gt; [6] -0.021074850</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="orientation-update">Orientation update<a class="anchor" aria-label="anchor" href="#orientation-update"></a>
</h2>
<p>We will now look at how to update our sensor orientation given the
IMU measurements. We will do that in 3 steps:</p>
<ul>
<li>Create a helper function</li>
<li>Update sensor orientation for one IMU reading</li>
<li>Update sensor orientation for a list of IMU readings</li>
</ul>
<div class="section level3">
<h3 id="helper-function">Helper function<a class="anchor" aria-label="anchor" href="#helper-function"></a>
</h3>
<p>We first wrap <code><a href="../reference/compUpdate.html">compUpdate()</a></code> in a helper function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myCompUpdate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">initQ</span>, <span class="va">accgyr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">acc</span> <span class="op">&lt;-</span> <span class="va">accgyr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">gyr</span> <span class="op">&lt;-</span> <span class="va">accgyr</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">50</span></span>
<span>  <span class="va">gain</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span>  <span class="va">orientation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compUpdate.html">compUpdate</a></span><span class="op">(</span><span class="va">acc</span>, <span class="va">gyr</span>, <span class="va">dt</span>, <span class="va">initQ</span>, <span class="va">gain</span><span class="op">)</span></span>
<span>  <span class="va">orientation</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="orientation-update-for-one-imu-reading">Orientation update for one IMU reading<a class="anchor" aria-label="anchor" href="#orientation-update-for-one-imu-reading"></a>
</h3>
<p>Next, we use the helper function to process the first two sensor
readings in our dataset. For the processing of the first reading, we
simply assume that the sensor’s initial orientation is aligned with the
world frame. However, for the procesing of the second reading, we take
the output of the processing of the first reading as the inital
orientation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="fu">myCompUpdate</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="va">lst_ned_in</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.9999657701 -0.0041990423 -0.0071175965 -0.0004080098</span></span>
<span><span class="op">(</span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="fu">myCompUpdate</span><span class="op">(</span><span class="va">q1</span>, <span class="va">lst_ned_in</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.9998798598 -0.0078567189 -0.0133472834 -0.0006228269</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="orientation-update-for-multiple-imu-readings">Orientation update for multiple IMU readings<a class="anchor" aria-label="anchor" href="#orientation-update-for-multiple-imu-readings"></a>
</h3>
<p>Now we will process the entire list of IMU readings. To do that we
take advantage of <code><a href="https://purrr.tidyverse.org/reference/accumulate.html" class="external-link">purrr::accumulate()</a></code> which automatically
takes the output of the current iteration as the input to the next
iteration:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orientations</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/accumulate.html" class="external-link">accumulate</a></span><span class="op">(</span><span class="va">lst_ned_in</span>, <span class="va">myCompUpdate</span>, .init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">orientations</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 0 0 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1]  0.9999657701 -0.0041990423 -0.0071175965 -0.0004080098</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1]  0.9998798598 -0.0078567189 -0.0133472834 -0.0006228269</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1]  0.9997609096 -0.0111531161 -0.0187912870 -0.0007868925</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1]  0.9996243467 -0.0139555857 -0.0235688255 -0.0009578893</span></span></code></pre></div>
<p>Note that the length of the output list is one more than that of the
input list, with the extra element being the initial quaternion of
<code>c(1, 0, 0, 0)</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="application-of-orientations">Application of orientations<a class="anchor" aria-label="anchor" href="#application-of-orientations"></a>
</h2>
<p>The result of the previous step is a list of sensor orientations
expressed as unit 4-vector rotation quaternions. We can use these
rotation quaternions to transform any vector in the sensor’s body frame
into the world frame.</p>
<p>Since the <code>walking_shin_1</code> dataset comes a sensor strapped
onto the shin of a subject while she walked for 10 minutes, as an
illustration we will use the sensor orientations to study the turns
taken by the subject during her journey.</p>
<p>We will do that in 3 steps:</p>
<ul>
<li>Use <code><a href="../reference/rotV.html">rotV()</a></code> to transform a vector from body frame to
world frame</li>
<li>Create a function to calculate the turn angle</li>
<li>Compute the turn angles at every time point</li>
</ul>
<div class="section level3">
<h3 id="vector-transformation">Vector transformation<a class="anchor" aria-label="anchor" href="#vector-transformation"></a>
</h3>
<p>We can transform any vector from the body frame to the world frame by
rotating the vector by the orientation of the sensor.
<code><a href="../reference/rotV.html">rotV()</a></code> performs such a rotation. For example, rotating a
vector pointing in the east-direction (<code>c(0, 1, 0)</code>) about
the north-direction by 90 degrees results in a vector pointing in the
down-direction (<code>c(0, 0, 1)</code>):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">pi</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">pi</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">vin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/rotV.html">rotV</a></span><span class="op">(</span><span class="va">q</span>, <span class="va">vin</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000000e+00 2.220446e-16 1.000000e+00</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="turn-angle-function">Turn angle function<a class="anchor" aria-label="anchor" href="#turn-angle-function"></a>
</h3>
<p>Next, we write a function to compute the turn angle from the rotated
vector:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getTurnAngle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">quat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># a function to rotate c(1, 0, 0) by quat</span></span>
<span>  <span class="co"># and then compute the angle between (1, 0, 0) and the rotated vector</span></span>
<span>  <span class="co"># projected onto the n-e plane and </span></span>
<span>  <span class="co"># this construct is to detect turns</span></span>
<span>  <span class="va">rotVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rotV.html">rotV</a></span><span class="op">(</span><span class="va">quat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">atan2</a></span><span class="op">(</span><span class="va">rotVec</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">rotVec</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">180</span> <span class="op">/</span> <span class="va">pi</span></span>
<span>  <span class="va">theta</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="turn-angles-for-all-time-points">Turn angles for all time points<a class="anchor" aria-label="anchor" href="#turn-angles-for-all-time-points"></a>
</h3>
<p>Lastly, we compute all the turn angles using
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnAngles</span> <span class="op">&lt;-</span> <span class="va">orientations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">getTurnAngle</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">turnAngles</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.00000000 -0.04333247 -0.05936656 -0.06618022 -0.07211392 -0.08646343</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analyses-of-turn-angles">Analyses of turn angles<a class="anchor" aria-label="anchor" href="#analyses-of-turn-angles"></a>
</h3>
<p>Let’s take a look at the results:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># create a vector of time stamps in minutes</span></span>
<span><span class="co"># note that sampling frequency is 50 Hz</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">turnAngles</span><span class="op">)</span> <span class="op">/</span> <span class="fl">50</span> <span class="op">/</span> <span class="fl">60</span></span>
<span><span class="co">#</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">turnAngles</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="imuf_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>There are some sharp jumps in the turn angles. And the reason for
that is <code><a href="https://rdrr.io/r/base/Trig.html" class="external-link">atan2()</a></code> restricts the angles to -180 and +180. So
an angle of 181 becomes -179 breaking continuity. We can use a function
to remove those artificial jumps and maintain continuity:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># a function to remove artificial jumps in turn angles</span></span>
<span><span class="va">rmJumps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">firstDiffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="va">bigDiffIdx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">firstDiffs</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># fix #1</span></span>
<span>  <span class="va">theta</span><span class="op">[</span><span class="op">(</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="op">(</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">360</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># fix #2</span></span>
<span>  <span class="va">theta</span><span class="op">[</span><span class="op">(</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="op">(</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">360</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># fix #3</span></span>
<span>  <span class="va">theta</span><span class="op">[</span><span class="op">(</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="op">(</span><span class="va">bigDiffIdx</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="fl">360</span></span>
<span>  <span class="va">theta</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># remove artificial jumps</span></span>
<span><span class="va">turnAnglesNoJumps</span> <span class="op">&lt;-</span> <span class="fu">rmJumps</span><span class="op">(</span><span class="va">turnAngles</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># plot it</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">turnAnglesNoJumps</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="imuf_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>There remains some jumps in turn angles. But these jumps are not
artificial. They reflect the actual behaviors of the subject during her
journey. For example, at 5 minute mark, the data suggests she made a 180
degree turn. And this can indeed be confirmed by the <a href="http://wifo5-14.informatik.uni-mannheim.de/sensor/dataset/realworld2016/proband1/videos/video_walking.webm" class="external-link">video</a>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># zero in on +/- 10 sec around 5 minute mark</span></span>
<span><span class="va">idx_5min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14800</span><span class="op">:</span><span class="fl">15750</span><span class="op">)</span></span>
<span><span class="va">x_5min</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">idx_5min</span><span class="op">]</span></span>
<span><span class="va">turn_5min</span> <span class="op">&lt;-</span> <span class="va">turnAnglesNoJumps</span><span class="op">[</span><span class="va">idx_5min</span><span class="op">]</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># plot it</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_5min</span>, y <span class="op">=</span> <span class="va">turn_5min</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="imuf_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Felix Chan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
